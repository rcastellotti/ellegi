!function (e) { function t(r) { if (n[r]) return n[r].exports; var i = n[r] = { i: r, l: !1, exports: {} }; return e[r].call(i.exports, i, i.exports, t), i.l = !0, i.exports } var n = {}; t.m = e, t.c = n, t.d = function (e, n, r) { t.o(e, n) || Object.defineProperty(e, n, { configurable: !1, enumerable: !0, get: r }) }, t.n = function (e) { var n = e && e.__esModule ? function () { return e.default } : function () { return e }; return t.d(n, "a", n), n }, t.o = function (e, t) { return Object.prototype.hasOwnProperty.call(e, t) }, t.p = "", t(t.s = 2) }([function (e, t) { e.exports = jQuery }, function (e, t) { e.exports = _ }, function (e, t, n) { $ = n(0), pages = { codesearch: n(3), fileview: n(9) }, $(function () { window.page && pages[window.page].init(window.scriptData) }) }, function (e, t, n) { function r() { return window.getSelection ? window.getSelection().toString() : null } function i(e) { "use strict"; function t(e) { var t = /^refs\/(tags|branches)\/(.*)/.exec(e); return t ? t[2] : (t = /^([0-9a-f]{8})[0-9a-f]+$/.exec(e)) ? t[1] : (t = /^origin\/(.*)/.exec(e), t ? t[1] : e) } function n(e, t, n, r) { return e in E.internalViewRepos ? i(e, n, r) : u(e, t, n, r) } function i(e, t, n) { t = t.replace(/^\/+/, ""); var r = "/view/" + e + "/" + t; return void 0 !== n && (r += "#L" + n), r } function u(e, t, n, r) { var i = c.in_flight.backend, s = E.repo_urls[i]; return s && s[e] ? p(s[e], e, t, n, r) : null } function p(e, n, r, i, s) { return void 0 === s && (s = 1), -1 !== e.indexOf("/{path}") && (i = i.replace(/^\/+/, "")), e = e.replace(/{lno}/g, s), e = e.replace(/{version}/g, t(r)), e = e.replace(/{name}/g, n), e = e.replace(/{basename}/g, n.split("/")[1]), e = e.replace(/{path}/g, i) } function d(e, t, n, r, i) { e = e.filter(function (e) { return !e.whitelist_pattern || e.whitelist_pattern.test(t + ":" + n + ":" + r) }); for (var s = e.map(function (e) { var s = { cls: "file-action-link", href: p(e.url_template, t, n, r, i) }; return e.target && (s.target = e.target), f.a(s, [e.label]) }), o = [], a = 0; a < s.length; a++)a > 0 && o.push(f.span({ cls: "file-action-link-separator" }, ["·"])), o.push(s[a]); return o } var f = new s.HTMLFactory, g = 0, m = o.View.extend({ tagName: "div", initialize: function () { this.model.on("change", this.render, this) }, render: function () { var e = this._render(); return this.setElement(e), this }, _renderLno: function (e, t) { var n = e.toString() + (t ? ":" : "-"), r = ["lno-link"]; return t && r.push("matchlno"), f.a({ cls: r.join(" "), href: this.model.url(e) }, [f.span({ cls: "lno", "aria-label": n }, [])]) }, _render: function () { var e, t = [], n = [], r = this.model.get("lno"), i = this.model.get("context_before"), s = this.model.get("clip_before"), o = this.model.get("context_after"), a = this.model.get("clip_after"), c = Math.max(0, i.length - (s || 0)); for (e = 0; e < c; e++)t.unshift(this._renderLno(r - e - 1, !1), f.span([this.model.get("context_before")[e]]), f.span({}, [])); var l = Math.max(0, o.length - (a || 0)); for (e = 0; e < l; e++)n.push(this._renderLno(r + e + 1, !1), f.span([this.model.get("context_after")[e]]), f.span({}, [])); var h = this.model.get("line"), u = this.model.get("bounds"), p = [h.substring(0, u[0]), h.substring(u[0], u[1]), h.substring(u[1])], _ = ["match"]; void 0 !== s && _.push("clip-before"), void 0 !== a && _.push("clip-after"); var g = d(E.linkConfigs.filter(function (e) { return e.url_template.includes("{lno}") }), this.model.get("tree"), this.model.get("version"), this.model.get("path"), r); return f.div({ cls: _.join(" ") }, [f.div({ cls: "contents" }, [].concat(t, [this._renderLno(r, !0), f.span({ cls: "matchline" }, [p[0], f.span({ cls: "matchstr" }, [p[1]]), p[2]]), f.span({ cls: "matchlinks" }, g)], n))]) } }), v = o.Model.extend({ path_info: function () { var e = this.get("tree"), t = this.get("version"), n = this.get("path"); return { id: e + ":" + t + ":" + n, tree: e, version: t, path: n } }, url: function (e) { return void 0 === e && (e = this.get("lno")), n(this.get("tree"), this.get("version"), this.get("path"), e) } }), x = o.Model.extend({ initialize: function (e) { this.id = e.id, this.path_info = e, this.matches = [] }, add_match: function (e) { this.matches.push(e) }, process_context_overlaps: function () { if (this.matches && !(this.matches.length < 2)) { this.matches.sort(function (e, t) { return e.get("lno") - t.get("lno") }); for (var e = 1, t = this.matches.length; e < t; e++) { var n = this.matches[e - 1], r = this.matches[e], i = n.get("lno") + n.get("context_after").length, s = r.get("lno") - r.get("context_before").length; if (i - s + 1 >= 0) { var o = parseInt(Math.ceil((n.get("lno") + r.get("lno")) / 2), 10); o < s ? o = s : i + 1 < o && (o = i + 1); var a = i - (o - 1), c = o - s; n.set("clip_after", a), r.set("clip_before", c) } else n.unset("clip_after"), r.unset("clip_before") } } } }), w = o.Collection.extend({ add_match: function (e) { var t = e.path_info(), n = this.get(t.id); n || (n = new x(t), this.add(n)), n.add_match(e) }, num_matches: function () { return this.reduce(function (e, t) { return e + t.matches.length }, 0) } }), k = o.Model.extend({ path_info: function () { var e = this.get("tree"), t = this.get("version"), n = this.get("path"); return { id: e + ":" + t + ":" + n, tree: e, version: t, path: n, bounds: this.get("bounds") } }, url: function () { return n(this.get("tree"), this.get("version"), this.get("path")) } }), b = o.View.extend({ tagName: "div", render: function () { var e = this.model.path_info(), n = [e.path.substring(0, e.bounds[0]), e.path.substring(e.bounds[0], e.bounds[1]), e.path.substring(e.bounds[1])], r = [f.span({ cls: "repo" }, [e.tree, ":"]), f.span({ cls: "version" }, [t(e.version), ":"]), n[0], f.span({ cls: "matchstr" }, [n[1]]), n[2]], i = this.$el; return i.empty(), i.addClass("filename-match"), i.append(f.a({ cls: "label header result-path", href: this.model.url() }, r)), this } }), y = o.Model.extend({ defaults: function () { return { context: !0, displaying: null, error: null, search_type: "", time: null, why: null } }, initialize: function () { this.search_map = {}, this.search_results = new w, this.file_search_results = new o.Collection, this.search_id = 0, this.on("change:displaying", this.new_search, this) }, new_search: function () { this.set({ error: null, time: null, why: null }), this.search_results.reset(), this.file_search_results.reset(); for (var e in this.search_map) parseInt(e) < this.get("displaying") && delete this.search_map[e] }, next_id: function () { return ++this.search_id }, dispatch: function (e) { var t = this.search_map[this.get("displaying")]; if (t && t.q === e.q && t.fold_case === e.fold_case && t.regex === e.regex && t.backend === e.backend && _.isEqual(t.repo, e.repo)) return !1; var n = this.next_id(); return e.id = n, this.search_map[n] = { q: e.q, fold_case: e.fold_case, regex: e.regex, backend: e.backend, repo: e.repo }, !!e.q.length || (this.set("displaying", n), !1) }, url: function () { var e = {}, t = this.search_map[this.get("displaying")]; if (!t) return "/search"; var n = "/search"; "" !== t.q && (e.q = t.q, e.fold_case = t.fold_case, e.regex = t.regex, e.context = this.get("context"), e.repo = t.repo), t.backend ? n += "/" + t.backend : E.input_backend && (n += "/" + E.input_backend.val()); var r = $.param(e); return n + (r ? "?" + r : "") }, title: function () { var e = this.search_map[this.get("displaying")]; return e && e.q ? e.q + " ⋅ search" : "code search" }, handle_error: function (e, t) { e === this.search_id && (this.set("displaying", e), this.set("error", t)) }, handle_match: function (e, t) { if (e < this.get("displaying")) return !1; this.set("displaying", e); var n = _.clone(t); n.backend = this.search_map[e].backend, this.search_results.add_match(new v(n)) }, handle_file_match: function (e, t) { if (e < this.get("displaying")) return !1; this.set("displaying", e); var n = _.clone(t); n.backend = this.search_map[e].backend, this.file_search_results.add(new k(n)) }, handle_done: function (e, t, n, r) { if (e < this.get("displaying")) return !1; this.set("displaying", e), this.set({ time: t, search_type: n, why: r }), this.search_results.trigger("search-complete") } }), S = o.View.extend({ tagName: "div", render_header: function (e, n, r) { var i, s, o = r.lastIndexOf("/"); -1 !== o ? (i = r.substring(o + 1, r.length), s = r.substring(0, o + 1)) : (i = r, s = ""); var a = this.model.matches[0], c = [f.span({ cls: "header-path" }, [f.a({ cls: "result-path", href: a.url() }, [f.span({ cls: "repo" }, [e, ":"]), f.span({ cls: "version" }, [t(n), ":"]), s, f.span({ cls: "filename" }, [i])])]), f.div({ cls: "header-links" }, d(E.linkConfigs, e, n, r, a.get("lno")))]; return f.div({ cls: "header" }, c) }, render: function () { var e = this.model.matches, t = this.$el; return t.empty(), t.append(this.render_header(this.model.path_info.tree, this.model.path_info.version, this.model.path_info.path)), e.forEach(function (e) { t.append(new m({ model: e }).render().el) }), t.addClass("file-group"), this } }), C = o.View.extend({ el: $("#results"), events: { "click .file-extension": "_limitExtension", keydown: "_handleKey" }, initialize: function () { this.model.search_results.on("search-complete", this.render, this), this.model.search_results.on("rerender", this.render, this) }, render: function () { this.$el.empty(); var e = {}, t = function (t) { var n = /[^\/](\.[a-z.]{1,6})$/i, r = t.match(n); if (r) { var i = r[1]; e[i] = e[i] ? e[i] + 1 : 1 } }, n = f.div({ cls: "path-results" }), r = 0; this.model.file_search_results.each(function (e) { if ("filename_only" == this.model.get("search_type") || r < 10) { var i = new b({ model: e }); n.append(i.render().el) } t(e.attributes.path), r += 1 }, this), this.$el.append(n), this.model.search_results.each(function (e) { e.process_context_overlaps(); var n = new S({ model: e }); this.$el.append(n.render().el), t(e.path_info.path) }, this); var i = this.model.search_id; return /\bfile:/.test(this.model.search_map[i].q) || this._render_extension_buttons(e), this }, _render_extension_buttons: function (e) { var t = []; for (var n in e) t.push([e[n], n]); if (!(t.length < 2)) { t.sort(function (e, t) { return t[0] - e[0] }); for (var r = [], i = Math.min(t.length, 5), s = 0; s < i; s++)r.push(t[s][1]); r.sort(); for (var o = f.div({ cls: "file-extensions" }, ["Narrow to:"]), s = 0; s < r.length; s++) { var n = r[s]; o.append(f.button({ cls: "file-extension" }, [n])) } this.$el.prepend(o) } }, _limitExtension: function (e) { var t = e.target.textContent, n = E.input.val(); n = E.input_regex.is(":checked") ? "file:\\" + t + "$ " + n : "file:" + t + " " + n, E.input.val(n), E.newsearch() }, _handleKey: function (e) { if (!(event.altKey || event.ctrlKey || event.metaKey || event.shiftKey)) { if (event.which === h.SLASH_OR_QUESTION_MARK) { var t = r(); if (!t) return; event.preventDefault(), E.input_regex.is(":checked") && (t = t.replace(/[.*+?^${}()|[\]\\]/g, "\\$&")), g = 0, E.input.val(t), E.newsearch() } } } }), T = o.View.extend({ el: $("#resultarea"), initialize: function () { this.matches_view = new C({ model: this.model }), this.results = this.$("#numresults"), this.errorbox = $("#regex-error"), this.time = this.$("#searchtime"), this.last_url = null, this.last_title = null, this.model.on("all", this.render, this), this.model.search_results.on("all", this.render, this) }, render: function () { if (null !== this.model.get("displaying")) { this.model.get("error") ? (this.errorbox.find("#errortext").text(this.model.get("error")), this.errorbox.show()) : this.errorbox.hide(); var e = this.model.url(); if (this.last_url !== e) { if (history.pushState) { if (window.location.pathname + window.location.search !== e) { var t = Date.now(); null === this.last_url ? history.replaceState(null, "", e) : t - g > 2e3 ? history.pushState(null, "", e) : history.replaceState(null, "", e), g = t } } this.last_url = e } var n = this.model.title(); if (this.last_title !== n && (document.title = n, this.last_title = n), "" === this.model.search_map[this.model.get("displaying")].q || this.model.get("error")) return this.$el.hide(), $("#helparea").show(), this; if ($("#results").toggleClass("no-context", !this.model.get("context")), this.$el.show(), $("#helparea").hide(), this.model.get("time")) { this.$("#searchtimebox").show(); var r = this.model.get("time"); this.time.text(r / 1e3 + "s") } else this.$("#searchtimebox").hide(); var i; return i = "filename_only" == this.model.get("search_type") ? "" + this.model.file_search_results.length : "" + this.model.search_results.num_matches(), "NONE" !== this.model.get("why") && (i += "+"), this.results.text(i), this } } }), E = function () { return { state: new y, view: null, onload: function () { E.input || (E.view = new T({ model: E.state }), E.input = $("#searchbox"), E.input_repos = $("#repos"), E.input_backend = $("#backend"), 0 == E.input_backend.length && (E.input_backend = null), E.inputs_case = $("input[name=fold_case]"), E.input_regex = $("input[name=regex]"), E.input_context = $("input[name=context]"), 0 == E.inputs_case.filter(":checked").length && E.inputs_case.filter("[value=auto]").attr("checked", !0), l.init(), E.update_repo_options(), E.init_query(), E.input.keydown(E.keypress), E.input.bind("paste", E.keypress), E.input.focus(), E.input_backend && E.input_backend.change(E.select_backend), E.inputs_case.change(E.keypress), E.input_regex.change(E.keypress), E.input_repos.change(E.keypress), E.input_context.change(E.toggle_context), E.input_regex.change(function () { E.set_pref("regex", E.input_regex.prop("checked")) }), E.input_repos.change(function () { E.set_pref("repos", E.input_repos.val()) }), E.input_context.change(function () { E.set_pref("context", E.input_context.prop("checked")) }), E.toggle_context(), c.connect(E), $(".query-hint code").click(function (e) { var t = e.target.textContent, n = E.input.val(); n.includes(t) || (0 != t.indexOf("-") || n.includes(t.substring(1))) && (0 == t.indexOf("-") || n.includes("-" + t.substring)) || (n = n + " " + t), E.input.val(n), E.input.focus() }), window.onpopstate = function (e) { var t = E.parse_query_params(); E.init_query_from_parms(t), E.newsearch() }) }, toggle_context: function () { E.state.set("context", E.input_context.prop("checked")) }, init_query: function () { var e = E.parse_query_params(), t = !1; for (var n in e) { t = !0; break } t ? E.init_query_from_parms(e) : E.init_controls_from_prefs(), setTimeout(E.keypress, 0) }, init_query_from_parms: function (e) { var t = []; e.q && t.push(e.q[0]), e.file && t.push("file:" + e.file[0]), E.input.val(t.join(" ")), e.fold_case && E.inputs_case.filter("[value=" + e.fold_case[0] + "]").attr("checked", !0), e.regex && E.input_regex.prop("checked", "true" === e.regex[0]), e.context && E.input_context.prop("checked", "true" === e.context[0]); var n = null; e.backend && (n = e.backend); var r; if ((r = new RegExp("/search/([^/]+)/?").exec(window.location.pathname)) && (n = r[1]), n && E.input_backend) { var i = E.input_backend.val(); E.input_backend.val(n), null === E.input_backend.val() && E.input_backend.val(i) } var s = []; e.repo && (s = s.concat(e.repo)), e["repo[]"] && (s = s.concat(e["repo[]"])), l.updateSelected(s) }, init_controls_from_prefs: function () { var e = a.getJSON("prefs"); e || (e = {}), void 0 !== e.regex && E.input_regex.prop("checked", e.regex), void 0 !== e.repos ? l.updateSelected(e.repos) : void 0 !== E.defaultSearchRepos && l.updateSelected(E.defaultSearchRepos), void 0 !== e.context && E.input_context.prop("checked", e.context) }, set_pref: function (e, t) { var n = a.getJSON("prefs"); n || (n = {}), n[e] = t, a.set("prefs", n, { expires: 36500 }) }, parse_query_params: function () { for (var e, t = {}, n = /\+/g, r = /([^&=]+)=?([^&]*)/g, i = function (e) { return decodeURIComponent(e.replace(n, " ")) }, s = window.location.search.substring(1); e = r.exec(s);)t[i(e[1])] ? t[i(e[1])].push(i(e[2])) : t[i(e[1])] = [i(e[2])]; return t }, on_connect: function () { E.newsearch() }, select_backend: function () { E.input_backend && (E.update_repo_options(), E.keypress()) }, update_repo_options: function (e) { if (E.input_backend) { var t = E.input_backend.val(); l.updateOptions(_.keys(E.repo_urls[t])) } }, keypress: function () { E.clear_timer(), E.timer = setTimeout(E.newsearch, 100) }, newsearch: function () { E.clear_timer(); var e = { q: E.input.val(), fold_case: E.inputs_case.filter(":checked").val(), regex: E.input_regex.is(":checked"), repo: E.input_repos.val() }; E.input_backend && (e.backend = E.input_backend.val()), E.state.dispatch(e) && c.new_search(e) }, clear_timer: function () { E.timer && (clearTimeout(E.timer), E.timer = null) }, error: function (e, t) { E.state.handle_error(e, t) }, match: function (e, t) { E.state.handle_match(e, t) }, file_match: function (e, t) { E.state.handle_file_match(e, t) }, search_done: function (e, t, n, r) { E.state.handle_done(e, t, n, r) }, repo_urls: {} } }(); E.repo_urls = e.repo_urls, E.internalViewRepos = e.internal_view_repos, E.defaultSearchRepos = e.default_search_repos, E.linkConfigs = (e.link_configs || []).map(function (e) { return e.whitelist_pattern && (e.whitelist_pattern = new RegExp(e.whitelist_pattern)), e }), E.onload() } var s = n(4), o = n(5), a = n(6), c = n(7).Codesearch, l = n(8), h = { SLASH_OR_QUESTION_MARK: 191 }; e.exports = { init: i } }, function (e, t) { function n() { } !function () { "use strict"; var e = { blur: !0, change: !0, click: !0, dblclick: !0, error: !0, focus: !0, focusin: !0, focusout: !0, keydown: !0, keypress: !0, keyup: !0, load: !0, mousedown: !0, mouseenter: !0, mouseleave: !0, mousemove: !0, mouseout: !0, mouseover: !0, mouseup: !0, resize: !0, scroll: !0, select: !0, submit: !0 }; _("A ABBR ACRONYM B BDO BIG BLOCKQUOTE BR BUTTON CAPTION CITE CODE COL COLGROUP DD DEL DFN DIV DL DT EM FIELDSET FORM H1 H2 H3 H4 H5 H6 HR I IFRAME IMG INPUT INS KBD LABEL LEGEND LI OBJECT OL OPTGROUP OPTION P PARAM PRE Q S SAMP SCRIPT SELECT SMALL SPAN STRIKE STRONG SUB SUP TABLE TBODY TD TEXTAREA TFOOT TH THEAD TR TT U UL VAR".split(" ")).forEach(function (t) { n.prototype[t.toLowerCase()] = function (n, r) { var i, s; r ? (i = n, s = r) : n instanceof Array ? (i = {}, s = n) : (i = n, s = []); var o = document.createElement(t); for (var a in i) "cls" === a ? o.setAttribute("class", i[a]) : "_for" === a ? o.setAttribute("for", i[a]) : e[a] ? $(o)[a](i[a]) : o.setAttribute(a, i[a]); var c = function (e) { _(e).forEach(function (e) { if (!e && "" !== e) throw new Error("Bad value for element body: " + e); e instanceof Array ? c(e) : "string" == typeof e ? o.appendChild(document.createTextNode(e)) : "number" == typeof e ? o.appendChild(document.createTextNode(e + "")) : "element" in e ? c([e.element]) : o.appendChild(e) }) }; return c(s), o } }) }(), e.exports = { HTMLFactory: n } }, function (e, t) { e.exports = Backbone }, function (e, t) { e.exports = Cookies }, function (e, t, n) { $ = n(0), _ = n(1); var r = function () { return { delegate: null, retry_time: 50, next_search: null, in_flight: null, connect: function (e) { void 0 !== e && (r.delegate = e), r.delegate.on_connect && setTimeout(r.delegate.on_connect, 0) }, new_search: function (e) { r.next_search = e, null == r.in_flight && r.dispatch() }, dispatch: function () { if (r.next_search) { r.in_flight = r.next_search, r.next_search = null; var e = r.in_flight, t = "/api/v1/search/"; "backend" in e && (t += e.backend); var n = { q: e.q, fold_case: e.fold_case, regex: e.regex, repo: e.repo }, i = $.ajax({ method: "POST", url: t, data: n, dataType: "json" }), s = new Date; i.done(function (t) { var n = new Date - s; t.results.forEach(function (t) { r.delegate.match(e.id, t) }), t.file_results.forEach(function (t) { r.delegate.file_match(e.id, t) }), r.delegate.search_done(e.id, n, t.search_type, t.info.why) }), i.fail(function (t) { if (window._err = t, t.status >= 400 && t.status < 500) { var n = JSON.parse(t.responseText); r.delegate.error(e.id, n.error.message) } else { var i = "Cannot connect to server"; t.status && (i = "Bad response " + t.status + " from server"), r.delegate.error(e.id, i), console.log("server error", t.status, t.responseText) } }), i.always(function () { r.in_flight = null, setTimeout(r.dispatch, 0) }) } } } }(); e.exports = { Codesearch: r } }, function (e, t, n) { function r() { o("#repos").selectpicker({ actionsBox: !0, selectedTextFormat: "count > 4", countSelectedText: "({0} repositories)", noneSelectedText: "(all repositories)", liveSearch: !0, width: "20em" }), o("#repos").on("refreshed.bs.select", function () { var e = o(this).parent().find(".dropdown-header"); e.css("cursor", "pointer"), e.on("click", function (e) { e.stopPropagation(); var t = o('#repos optgroup[label="' + o(this).text() + '"]'), n = !t.children("option:not(:selected)").length; t.children().prop("selected", !n), o("#repos").selectpicker("refresh").trigger("change") }) }), o(window).on("keyup", ".bootstrap-select .bs-searchbox input", function (e) { "13" == (e.keyCode ? e.keyCode : e.which) && (o(this).val(""), o("#repos").selectpicker("refresh")) }), o(window).keyup(function (e) { 9 == (e.keyCode ? e.keyCode : e.which) && o(".bootstrap-select button:focus").length && (o("#repos").selectpicker("toggle"), o(".bootstrap-select .bs-searchbox input").focus()) }) } function i(e) { var t = []; if (o("#repos").find("option").each(function () { t.push(o(this).attr("value")) }), !a.isEqual(t, e)) { o("#repos").empty(), e.sort(); var n = new Map; n.set("/", o("#repos")); for (var r = 0; r < e.length; r++) { var i = e[r].split("/"), s = i.slice(0, i.length - 1).join("/") + "/", c = i[i.length - 1]; if (!n.has(s)) { var l = o("<optgroup>").attr("label", s); o("#repos").append(l), n.set(s, l) } n.get(s).append(o("<option>").attr("value", s + c).text(c)) } n.clear(), o("#repos").selectpicker("refresh") } } function s(e) { o("#repos").selectpicker("val", e) } var o = n(0), a = n(1); e.exports = { init: r, updateOptions: i, updateSelected: s } }, function (e, t, n) { function r() { return window.getSelection ? window.getSelection().toString() : null } function i(e, t) { var n = $(window), r = n.height(), i = Math.floor(n.height() / 3), s = t.find("#L" + e.start); if (s.length) { if (e.start != e.end) { var o = t.find("#L" + e.end), a = o.offset().top + o.height() - s.offset().top; i = a <= r ? .5 * (r - a) : s.height() / 2 } n.scrollTop(s.offset().top - i) } } function s(e) { history.replaceState ? history.replaceState(null, null, e) : location.hash = e } function o(e) { var t = e.match(/#L(\d+)(?:-L?(\d+))?/); if (t && 3 === t.length) { var n = parseInt(t[1], 10), r = parseInt(t[2], 10); return (isNaN(r) || r < n) && (r = n), { start: n, end: r } } return null } function a(e, t) { for (var n = [], r = e.start; r <= e.end; r++)n.push("#L" + r); t.find(n.join(",")).addClass("highlighted") } function c(e) { var t = o(document.location.hash); if (t) { var n = parseInt(e.attr("id").replace("L", ""), 10); n < t.start ? (t.end = t.start, t.start = n) : t.end = n, s("#L" + t.start + "-" + t.end) } } function l(e) { function t(t, n, r) { var i; i = void 0 !== n ? "/search?q=" + encodeURIComponent(n) + "&repo=" + encodeURIComponent(e.repo_info.name) : "/search", !0 === r ? window.open(i) : window.location.href = i } function n() { w.removeClass("hidden").children().on("click", function (e) { return e.stopImmediatePropagation(), !0 }), $(document).on("click", l) } function l() { return w.addClass("hidden").children().off("click"), $(document).off("click", l), !0 } function u(e) { void 0 === e && (e = !0), x.find(".highlighted").removeClass("highlighted"); var t = o(document.location.hash); t && (a(t, x), e && i(t, v)), $("#external-link").attr("href", d(t)), f(t, $("#permalink, #back-to-head")) } function p(e) { return null == e ? 1 : e.start == e.end ? e.start : e.start + "-" + e.end } function d(t) { var n = p(t), r = e.repo_info.name, i = e.file_path; return url = e.repo_info.metadata.url_pattern, url ? (-1 !== url.indexOf("/{path}") && (i = i.replace(/^\/+/, "")), url = url.replace("{lno}", n), url = url.replace("{version}", e.commit), url = url.replace("{name}", r), url = url.replace("{path}", i), url) : void console.error("The index file you provided does not provide repositories[x].metadata.url_pattern. External links to file sources will not work. See the README for more information on file viewing.") } function f(e, t) { t.each(function () { var t = $(this), n = t.attr("href").split("#")[0]; null !== e && (n += "#L" + p(e)), t.attr("href", n) }) } function _(e) { if (e.which === h.ENTER) { var i = r(); i && t(e, i, !0) } else if (e.which === h.SLASH_OR_QUESTION_MARK) e.preventDefault(), e.shiftKey ? n() : (l(), t(e, r())); else if (e.which === h.ESCAPE) w.hasClass("hidden") || (e.preventDefault(), l()), $("#query").blur(); else if ("V" == String.fromCharCode(e.which)) $("#external-link").focus(), window.location = $("#external-link").attr("href"); else if ("Y" == String.fromCharCode(e.which)) { var s = $("#permalink"), o = s.length > 0; o && (s.focus(), window.location = s.attr("href")) } else if ("N" == String.fromCharCode(e.which) || "P" == String.fromCharCode(e.which)) { var a = "P" === String.fromCharCode(e.which), i = r(); i && window.find(i, !1, a) } return !0 } function g(e) { var r = { search: t, help: n }; for (var i in r) e.on("click auxclick", '[data-action-name="' + i + '"]', function (e) { return function (t) { t.preventDefault(), t.stopImmediatePropagation(), e.call(this, t) } }(r[i])) } function m() { u(), x.on("click", "a", function (e) { e.preventDefault(), e.shiftKey ? c($(e.target), x) : s($(e.target).attr("href")), u(!1) }), $(window).on("hashchange", function (e) { e.preventDefault(), u() }), $(document).on("keydown", function (e) { $(e.target).is("input,textarea") || e.altKey || e.ctrlKey || e.metaKey || _(e) }), $(document).mouseup(function () { var e = r(); e ? k(e) : b() }), g($(".header .header-actions")) } var v = $(".file-content"), x = v.find(".line-numbers"), w = $(".help-screen"), k = function () { $(".without-selection").hide(), $(".with-selection").show() }, b = function () { $(".without-selection").show(), $(".with-selection").hide() }; setTimeout(function () { x.css({ display: "block" }), m() }, 1) } $ = n(0); var h = { ESCAPE: 27, ENTER: 13, SLASH_OR_QUESTION_MARK: 191 }; e.exports = { init: l } }]);